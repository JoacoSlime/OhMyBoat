@page "/recover-password"
@layout LoginLayout
@inject HttpClient HttpClient
@using OhMyBoat.UI.Shared.Entidades;
@using OhMyBoat.UI.Shared;
@inject IJSRuntime JsRuntime;
@inject NavigationManager Navegador;

<div class="d-flex flex-column justify-content-center m-5 p-5 border">
    <div class="mb-3 text-center">
        <img src="LogoColorTransp.jpg" width="300" height="400">
        <h1>Recuperar cuenta</h1>
    </div>
    <div class="form_field">
        <div class="mb-5">
            <label for="email"><h3>E-mail de la cuenta a recuperar</h3></label>
            <input class="form-control mb-2" @bind="Email" type="text" placeholder="email@example.com" name="email" required asp-for="Email" />
        </div>
        <div class="d-flex justify-content-center">
            <button class="btn btn-primary btn-lg" type="submit" @onclick="Recuperar">Recuperar cuenta</button>
        </div>
    </div>
</div>

@code {
    private LoginDTO LoginDTO = new();
    private string Email { get; set; } = "";

    private async Task Recuperar()
    {
        if(!Utils.IsValidEmail(Email)){
            await JsRuntime.InvokeVoidAsync("alert", "Ingrese un correo valido");
            return;
        }else
        {
            LoginDTO.Email = Email;
            var respuestaSV = await HttpClient.PostAsJsonAsync<LoginDTO>("api/cuenta/Recuperacion", LoginDTO);
            if (respuestaSV.IsSuccessStatusCode)
            {
                await JsRuntime.InvokeVoidAsync("alert", "Si existe una cuenta asociada a ese email recibirá un correo para confirmar la recuperación de la cuenta");
                Navegador.NavigateTo("/");
            }
            else
            {
                await JsRuntime.InvokeVoidAsync("alert", "Error de API");
                Navegador.NavigateTo("/");
            }
        }
    }
}
